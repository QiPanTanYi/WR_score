{const t=this,{window:e}=t,s="responseType",{Boolean:n,Error:i,Object:a,Promise:l,chrome:o,performance:r}=t,{apply:c}=Reflect,d=(c.call.bind({}.hasOwnProperty),a.call.bind(a.call)),h=(o.app,o.runtime.getURL("/").slice(0,-1),o.runtime.getManifest());o.runtime.getURL(h.options_page),o.runtime.getURL(h.icons[16].replace("16.png","")),(()=>{var t,e={5082:(t,e,i)=>{"use strict";i(2993);var o=i(3293),c=(i(287),i(4017)),h=i(6522),u=(i(537),i(5517),i(6252)),p=i(2502);const m={class:"frame-block"},g={class:"flex"},f=(0,u._)("div",{class:"image"},[(0,u._)("img",{src:"/public/images/icon128.png"})],-1),v={class:"info"},w=["textContent"],C=["textContent"],b=["textContent"],x={class:"flex"},y=["textContent"],k=["href"],_=["textContent"],L=["textContent"],S=["data-collapsed"],$=["data-type","hidden"],D=["textContent"],O=["textContent"],I={class:"flex"},T={class:"image flex"},F=["src"],j={class:"actions flex flex-wrap mr-2c"},q=["textContent","data-hotkey","disabled"],z=["textContent"],P={class:"flex flex-col my-1"},M=["textContent"],W=["textContent","title"],Z=["textContent"],H={class:"frame-block flex-1 pos-rel"};var E=i(7181),R=i(6930),U=i(8250),B=i(8856),N=i(9727),Y=i(8694),A=i(3057),Q=i(5310),G=i(8292),J=i(3795);const K=(/Mac/.test(navigator.platform)?"Cmd":"Ctrl")+"-Enter",V=(0,B.Z)({lifetime:9e3});let X,tt,et,st,nt;const it={components:{Icon:R.Z,VmExternals:N.Z,SettingCheck:Y.Z,Tooltip:E.Z},data(){return{installable:!1,installed:!1,message:"",cmOptions:{lineWrapping:!0},code:"",commands:{close:this.close},confirmHotkey:K,info:{},deps:{},descr:"",error:null,heading:this.i18n("msgLoadingData"),lists:null,listsShown:!0,name:"...",reinstall:!1,safeIcon:null,sameCode:!1,script:null}},computed:{trackTooltip(){return J.Z.firefox>=68?this.i18n("installOptionTrackTooltip"):null},isLocal(){return!(0,o.Q1)(this.info.url)},icons(){const{script:t}=this,e=t&&(0,o.t$)(t),s=null==t?void 0:t.meta.supportURL;return[e&&[e,"home",this.i18n("labelHomepage")],s&&[s,"question",this.i18n("buttonSupport")]].filter(n)}},async mounted(){const t=`confirm-${G.BC.paths[0]}`,e=await(0,o.gj)("CacheLoad",t);this.info=e,e?(et=e.ff>=68&&e.url.startsWith("file:"),nt=(0,o.gj)("CachePop",e.url),this.guard=setInterval(o.gj,5e3,"CacheHit",{key:t}),await this.loadData(),await this.parseMeta(),await l.all([this.checkSameCode(),(async()=>{let t=2;for(;!await this.loadDeps()&&t;)await(0,o.dL)(3e3),t-=1})()]),this.installable&&(this.heading=this.reinstall?this.i18n("labelReinstall"):this.i18n("labelInstall")),this.disposeList=[U.$J.register("ctrlcmd-enter",()=>this.$refs.confirm.click())],U.$J.enable()):this.close()},beforeUnmount(){var t;this.guard&&(clearInterval(this.guard),this.guard=null),null==(t=this.disposeList)||t.forEach(t=>t())},methods:{async loadData(t){this.installable=!1;const e=et?await new l(this.pingFilePort):await this.getScript(this.info.url);if(null==e||t&&this.code===e)throw 0;this.setCode(e)},setCode(t){var e,s;const n=t.split(/\r?\n/),i=null==(e=this.$refs.externals)||null==(s=e.$refs.code)?void 0:s.cm;let a,l=-1;i&&i.eachLine(({text:t})=>(a=t!==n[l+=1],a)),this.code=t,(a||i&&l<n.length-1)&&this.$nextTick(()=>{i.setCursor(l),i.scrollIntoView(null,i.display.lastWrapHeight/3)})},async parseMeta(){const{meta:t,errors:e}=await(0,o.gj)("ParseMeta",this.code),s=(0,o.iQ)(t,"name");document.title=`${s.slice(0,100)}${s.length>100?"...":""} - ${st||(st=document.title)}`,this.name=d(o.Hv,[s,t.version],", "),this.descr=(0,o.iQ)(t,"description"),this.lists=(0,Q.zr)(t,["antifeature","grant","match","include","exclude","excludeMatch","compatible","connect"],t=>(null==t?void 0:t.map(t=>[t.replace(/^\W+/,"")||t,t]).sort(([t],[e])=>t<e?-1:t>e).map(([,t])=>t).join("\n"))||""),this.lists[""]=(null==e?void 0:e.join("\n"))||"",this.script={meta:t,custom:{},props:{}},this.allDeps=[[...new Set(t.require)],[...new Set(a.values(t.resources))]]},async loadDeps(){const{script:t,allDeps:[e,s]}=this;if(this.safeIcon||(0,A.d)(t).then(t=>{this.safeIcon=t}),this.require&&(0,Q.vZ)(e.slice().sort(),a.keys(this.require).sort())&&(0,Q.vZ)(s.slice().sort(),a.keys(this.resources).sort()))return;this.require={},this.resources={};const n=e.length+s.length;let i=0;const c=r.now(),h=()=>{r.now()-c>500&&(this.message=this.i18n("msgLoadingDependency",[i,n]))},u=async(t,e,s)=>{const n=(0,o.mn)(t,this.info.url),a=`${+s}${t}`;try{const t=await this.getFile(n,{isBlob:s,useCache:!0});e[n]=t,this.deps[a]=t,i+=1,h()}catch(e){return this.deps[a]=!1,t}},p=setTimeout(h,500),m=[...e.map(t=>u(t,this.require,!1)),...s.map(t=>u(t,this.resources,!0))],g=d(o.Hv,await l.all(m),"\n");if(clearTimeout(p),!g)return this.error=null,this.installable=!0,this.message=null,!0;this.message=this.i18n("msgErrorLoadingDependency"),this.error=g},close(){(0,o.gj)("TabClose")},async getFile(t,{isBlob:e,useCache:n}={}){const i=e?`blob+${t}`:`text+${t}`;if(n&&V.has(i))return V.get(i);const a=await(0,o.WY)(t,{[s]:e?"blob":null}),l=e?await(0,o.LZ)(a):a.data;return n&&V.put(i,l),l},async getScript(t){try{return nt&&await nt||await this.getFile(t)}catch(e){throw this.message=this.i18n("msgErrorLoadingData"),t}finally{nt=null}},async installScript(){this.installable=!1;try{const{update:t}=await(0,o.gj)("ParseScript",{code:this.code,url:this.info.url,from:this.info.from,require:this.require,cache:this.resources}),e=(new Date).toLocaleTimeString(["fr"]),s=this.confirmedTime||(this.confirmedTime=e);this.message=`${t.message} ${s}${s===e?"":` --\x3e ${e}`}`,this.installed=!0,this.isLocal&&this.$refs.trackLocalFile.value?this.trackLocalFile():this.$refs.closeAfterInstall.value&&this.close()}catch(t){this.message=`${t}`,this.installable=!0}},async trackLocalFile(){if(!this.tracking&&this.isLocal&&this.installed){for(nt=null,this.tracking=!0;this.$refs.trackLocalFile.value&&"stop"!==this.tracking;){await(0,o.dL)(500);try{await this.loadData(!0),await this.parseMeta(),await this.loadDeps(),await this.installScript(),this.sameCode=!1}catch(t){}}this.tracking=!1}},async checkSameCode(){const{name:t,namespace:e}=this.script.meta||{},s=await(0,o.gj)("GetScript",{meta:{name:t,namespace:e}});this.reinstall=!!s,this.sameCode=s&&this.code===await(0,o.gj)("GetScriptCode",s.props.id)},createFilePort(){X=browser.tabs.connect(this.info.tabId,{name:"FetchSelf"}),X.onMessage.addListener(t=>{tt(t)}),X.onDisconnect.addListener(()=>{this.tracking="stop"})},pingFilePort(t){X||this.createFilePort(),tt=t,X.postMessage(null)}}},at=(0,i(3744).Z)(it,[["render",(t,e)=>{var s;const n=(0,u.up)("icon"),i=(0,u.up)("tooltip"),a=(0,u.up)("setting-check"),l=(0,u.up)("vm-externals");return(0,u.wg)(),(0,u.iD)("div",{class:(0,p.C_)(["page-confirm frame flex flex-col h-screen",{reinstall:t.reinstall}])},[(0,u._)("div",m,[(0,u._)("div",g,[f,(0,u._)("div",v,[(0,u._)("h1",null,[(0,u._)("div",null,[(0,u._)("span",{textContent:(0,p.zw)(t.heading)},null,8,w),t.sameCode?((0,u.wg)(),(0,u.iD)("span",{key:0,textContent:(0,p.zw)(t.i18n("msgSameCode")),style:{"font-weight":"normal"}},null,8,C)):(0,u.kq)("",!0)]),(0,u._)("div",{class:"ellipsis",textContent:(0,p.zw)(t.name)},null,8,b)]),(0,u._)("div",x,[(0,u.Wm)(i,{content:t.i18n("editNavCode"),class:"abs-center",placement:"right"},{default:(0,u.w5)(()=>[(0,u.Wm)(n,{name:"code"})]),_:1},8,["content"]),(0,u._)("span",{class:"ellipsis",textContent:(0,p.zw)(t.info.url?decodeURIComponent(t.info.url):"...")},null,8,y)]),((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(t.icons,([t,e,s])=>((0,u.wg)(),(0,u.iD)("a",{key:e,class:"flex",target:"_blank",href:t},[(0,u.Wm)(i,{content:s,class:"abs-center",placement:"right"},{default:(0,u.w5)(()=>[(0,u.Wm)(n,{name:e},null,8,["name"])]),_:2},1032,["content"]),(0,u._)("span",{class:"ellipsis",textContent:(0,p.zw)(decodeURIComponent(t))},null,8,_)],8,k))),128)),(0,u._)("p",{class:"descr",textContent:(0,p.zw)(t.descr)},null,8,L),(0,u._)("div",{class:"lists flex flex-wrap","data-collapsed":!t.listsShown},[(0,u._)("div",{class:"toggle abs-center",onClick:e[0]||(e[0]=e=>t.listsShown=!t.listsShown)},[t.lists?((0,u.wg)(),(0,u.j4)(i,{key:0,content:t.i18n("msgShowHide"),placement:"bottom",align:"left"},{default:(0,u.w5)(()=>[(0,u.Wm)(n,{name:"info"})]),_:1},8,["content"])):(0,u.kq)("",!0)]),((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(t.lists,(e,s)=>((0,u.wg)(),(0,u.iD)("dl",{key:s,"data-type":s,hidden:!e.length,tabindex:"0"},[(0,u._)("dt",{textContent:(0,p.zw)(s?`@${s}`:t.i18n("genericError"))},null,8,D),(0,u._)("dd",{textContent:(0,p.zw)(e),class:"ellipsis"},null,8,O)],8,$))),128))],8,S)])]),(0,u._)("div",I,[(0,u._)("div",T,[(0,u._)("img",{src:t.safeIcon},null,8,F)]),(0,u._)("div",j,[(0,u._)("button",{id:"confirm",ref:"confirm",textContent:(0,p.zw)(t.reinstall?t.i18n("buttonConfirmReinstallation"):t.i18n("buttonConfirmInstallation")),"data-hotkey":t.confirmHotkey,onClick:e[1]||(e[1]=(...e)=>t.installScript&&t.installScript(...e)),disabled:!t.installable},null,8,q),(0,u._)("button",{textContent:(0,p.zw)(t.i18n("buttonClose")),onClick:e[2]||(e[2]=(...e)=>t.close&&t.close(...e))},null,8,z),(0,u._)("div",P,[(0,u.Wm)(a,{name:"closeAfterInstall",label:t.i18n("installOptionClose"),"data-disabled":t.isLocal&&!(null==(s=t.$refs.trackLocalFile)||!s.value),ref:"closeAfterInstall"},null,8,["label","data-disabled"]),(0,u.Wm)(a,{name:"trackLocalFile",onChange:t.trackLocalFile,ref:"trackLocalFile","data-disabled":!t.isLocal},{default:(0,u.w5)(()=>[(0,u.Wm)(i,{content:t.trackTooltip,disabled:!t.trackTooltip},{default:(0,u.w5)(()=>[(0,u._)("span",{textContent:(0,p.zw)(t.i18n("installOptionTrack"))},null,8,M)]),_:1},8,["content","disabled"])]),_:1},8,["onChange","data-disabled"])]),t.message?((0,u.wg)(),(0,u.iD)("div",{key:0,textContent:(0,p.zw)(t.message),title:t.error,class:"status"},null,8,W)):(0,u.kq)("",!0)])]),t.info.incognito?((0,u.wg)(),(0,u.iD)("div",{key:0,class:"incognito",textContent:(0,p.zw)(t.i18n("msgIncognitoChanges"))},null,8,Z)):(0,u.kq)("",!0)]),(0,u._)("div",H,[t.script?((0,u.wg)(),(0,u.j4)(l,{key:0,ref:"externals",value:t.script,class:"abs-full","cm-options":t.cmOptions,commands:t.commands,install:{code:t.code,deps:t.deps,url:t.info.url}},null,8,["value","cm-options","commands","install"])):(0,u.kq)("",!0)])],2)}]]),lt=at;document.title=`${(0,o.ag)("labelInstall")} - ${(0,o.ag)("extName")}`,c.Z.ready.then(()=>{(0,h.sY)(lt)})},6291:(t,e,s)=>{var n={"./arrow.svg":7864,"./author.svg":6263,"./code.svg":4237,"./cog.svg":8527,"./command.svg":6337,"./filter.svg":1691,"./home.svg":6447,"./info.svg":6396,"./more.svg":485,"./plus.svg":336,"./question.svg":934,"./refresh.svg":1727,"./search.svg":2574,"./toggle-off.svg":3882,"./toggle-on.svg":6276,"./trash.svg":2981,"./undo.svg":418};function l(t){var e=o(t);return s(e)}function o(t){if(!s.o(n,t)){var e=new i("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}l.keys=()=>a.keys(n),l.resolve=o,t.exports=l,l.id=6291},7462:(t,e,s)=>{"use strict";function n(){return n=a.assign?a.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)a.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},n.apply(this,arguments)}s.d(e,{Z:()=>n})}},o={};function c(t){var s=o[t];if(void 0!==s)return s.exports;var n=o[t]={exports:{}};return e[t].call(n.exports,n,n.exports,c),n.exports}c.m=e,t=[],c.O=(e,s,n,i)=>{if(!s){var l=1/0;for(h=0;h<t.length;h++){for(var[s,n,i]=t[h],o=!0,r=0;r<s.length;r++)(!1&i||l>=i)&&a.keys(c.O).every(t=>c.O[t](s[r]))?s.splice(r--,1):(o=!1,i<l&&(l=i));if(o){t.splice(h--,1);var d=n();void 0!==d&&(e=d)}}return e}i=i||0;for(var h=t.length;h>0&&t[h-1][2]>i;h--)t[h]=t[h-1];t[h]=[s,n,i]},c.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return c.d(e,{a:e}),e},c.d=(t,e)=>{for(var s in e)c.o(e,s)&&!c.o(t,s)&&a.defineProperty(t,s,{enumerable:!0,get:e[s]})},c.o=(t,e)=>a.prototype.hasOwnProperty.call(t,e),c.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&a.defineProperty(t,Symbol.toStringTag,{value:"Module"}),a.defineProperty(t,"__esModule",{value:!0})},c.j=47,(()=>{var t={47:0};c.O.j=e=>0===t[e];var e=(e,s)=>{var n,i,[a,l,o]=s,r=0;if(a.some(e=>0!==t[e])){for(n in l)c.o(l,n)&&(c.m[n]=l[n]);if(o)var d=o(c)}for(e&&e(s);r<a.length;r++)i=a[r],c.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return c.O(d)},s=self.webpackChunkviolentmonkey=self.webpackChunkviolentmonkey||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})();var h=c.O(void 0,[386,84],()=>c(5082));h=c.O(h)})()}